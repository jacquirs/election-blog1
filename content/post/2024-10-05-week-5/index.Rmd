---
title: 'Week 5: Demographics, Turnout, and the First Stage of Our Final Prediction'
author: Jacqui Schlesinger
date: '2024-10-05'
slug: week-5
categories: []
tags: []
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
####----------------------------------------------------------#
#### Get Libraries 
####----------------------------------------------------------#
setwd("C:/Users/Jacqui Schlesinger/Documents/election-blog1/")
library(car)
library(caret)
library(CVXR)
library(foreign)
library(glmnet)
library(haven)
library(janitor)
library(kableExtra)
library(maps)
library(mlr3)
library(randomForest)
library(ranger)
library(RColorBrewer)
library(sf)
library(tidyverse)
library(viridis)

```

```{r}
####----------------------------------------------------------#
#### Load Datafiles
####----------------------------------------------------------#

# Read popular vote datasets
d_popvote <- read_csv("popvote_1948_2020.csv")
d_state_popvote <- read_csv("state_popvote_1948_2020.csv")

# Read elector distribution dataset
d_ec <- read_csv("corrected_ec_1948_2024.csv")

# Read and merge demographics data
d_demos <- read_csv("demographics.csv")[,-1]

# Read primary turnout data
d_turnout <- read_csv("turnout_1789_2020.csv")
d_state_turnout <- read_csv("state_turnout_1980_2022.csv")
d_state_turnout <- d_state_turnout |> 
  mutate(vep_turnout = as.numeric(str_remove(vep_turnout, "%"))/100) |> 
  select(year, state, vep_turnout)

# Read polling data
d_polls <- read_csv("national_polls_1968-2024.csv")
d_state_polls <- read_csv("state_polls_1968-2024.csv")

# Process state-level polling data
d_pollav_state <- d_state_polls |> 
  group_by(year, state, party) |>
  mutate(mean_pollav = mean(poll_support, na.rm = TRUE)) |>
  top_n(1, poll_date) |> 
  rename(latest_pollav = poll_support) |>
  select(-c(weeks_left, days_left, poll_date, candidate, before_convention)) |>
  pivot_wider(names_from = party, values_from = c(latest_pollav, mean_pollav))
                             
```

```{r}
####----------------------------------------------------------#
#### ANES Data Processing 
####----------------------------------------------------------#

# Read processed ANES data
anes <- read_dta("anes_timeseries_cdf_stata_20220916.dta") # Total ANES Cumulative Data File

anes <- anes |> 
  mutate(year = VCF0004,
         pres_vote = case_when(VCF0704a == 1 ~ 1, 
                               VCF0704a == 2 ~ 2, 
                               .default = NA), 
         # Demographics
         age = VCF0101, 
         gender = VCF0104, # 1 = Male; 2 = Female; 3 = Other
         race = VCF0105b, # 1 = White non-Hispanic; 2 = Black non-Hispanic, 3 == Hispanic; 4 = Other or multiple races, non-Hispanic; 9 = missing/DK
         educ = VCF0110, # 0 = DK; 1 = Less than high school; 2. High school; 3 = Some college; 4 = College+ 
         income = VCF0114, # 1 = 0-16 percentile; 2 = 17-33 percentile; 3 = 34-67; 4 = 68 to 95; 5 = 96 to 100. 
         religion = VCF0128, # 0 = DK; 1 = Protestant; 2 = Catholic; 3 = Jewish; 4 = Other
         attend_church = case_when(
           VCF0004 < 1972 ~ as.double(as.character(VCF0131)),
           TRUE ~ as.double(as.character(VCF0130))
         ), # 1 = every week - regularly; 2 = almost every week - often; 3 = once or twice a month; 4 = a few times a year - seldom; 5 = never ; 6 = no religious preference
         southern = VCF0113,
         region = VCF0113, 
         work_status = VCF0118,
         homeowner = VCF0146, 
         married = VCF0147,
        
         # 7-point PID
         pid7 = VCF0301, # 0 = DK; 1 = Strong Democrat; 2 = Weak Democrat; 3 = Independent - Democrat; 4 = Independent - Independent; 5 = Independent - Republican; 6 = Weak Republican; 7 = Strong Republican
         
         # 3-point PID
         pid3 = VCF0303, # 0 = DK; 1 = Democrats; 2 = Independents; 3 = Republicans. 
         
         # 3-point ideology. 
         ideo = VCF0804 # 0, 9 = DK; 1 = Liberal; 2 = Moderate; 3 = Conservative
         ) |> 
  select(year, pres_vote, age, gender, race, educ, income, religion, attend_church, southern, 
         region, work_status, homeowner, married, pid7, pid3, ideo)

```

_Note: For this week of class, I was in charge of putting together a presentation of my findings. As a result, this post and the accompanying code as seen on Github contain many more plots than in past weeks, many of which are simply descriptive and exploratory statistics._

Happy 30 days until the election all! This week, I focus on refining my models by introducing the final fundamentals I have learned in class, demographics and turnout data. Additionally, I hone in on the states identified last week through expert prediction to be those I will model exclusively as they are the swing states that could decided the next president of the United States. These states are  **Wisconsin, Pennsylvania, North Carolina, Nevada, Michigan, Georgia, and Arizona**. 

The decision to predict the popular vote in these states alone stems from the expert predictions from organizations like the [Cook Political Report](https://www.cookpolitical.com/) and [Sabato's Crystal Ball](https://centerforpolitics.org/crystalball/), who predict most other states to be safely in either Donald Trump's or Kamala Harris's court for the upcoming election. As such, I count their electoral vote for their respective candidate and move to predict the lesser known outcomes of the seven swing states. 

In this blog post, I begin by exploring the voterfiles for these key states, diving into the specific demographics and those which are most associated with voting behavior. Additionally, I replicate Kim & Zilinsky (2023) findings on the power of demographics to predict turnout and voter share using ANES data, deciding if and how to incorporate this new data point into my model. Building on the elastic net regression ensemble of polling data and economic fundamentals from the last few posts, I explore simulations of the result of the election, also considering random forest methods. 


### Exploring the Voterfile
Voterfile data allow me to see granular information on the demographic characteristics of the voting population of each state. The voterfiles for this post were graciously provided by [Statara Solutions](https://statara.com/). In the following plots, I break down the voterfile data for our seven states of interest

```{r}
####----------------------------------------------------------#
#### Custom Theme
####----------------------------------------------------------#

 barplot_theme <- theme_bw() + 
  theme(
    # Axis text and labels
    axis.title = element_text(face = "bold", size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    axis.text.y = element_text(size = 10),
    
    # Legend position and text
    legend.position = "right",
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10),
    
    # Title
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    
    panel.border = element_rect(color = "black"),
    
    # Grid lines
    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_line(color = "grey95"),
    
    # Background color
    plot.background = element_rect(fill = "white", color = NA)
  )
```


```{r}
####----------------------------------------------------------#
#### Voterfile data loading
####----------------------------------------------------------#

# Read and merge 1% voterfile data into one dataset. 
voterfile.sample.files <- list.files("state_1pc_samples_aug24")

voterfile.complete <- read_csv(paste0("state_1pc_samples_aug24/", voterfile.sample.files[1]))
for (i in 2:length(voterfile.sample.files)) {
  temp <- read_csv(paste0("state_1pc_samples_aug24/",voterfile.sample.files[i]))
  voterfile.complete <- rbind(voterfile.complete, temp)
}

```

```{r}
####----------------------------------------------------------#
#### Pull our 7 state of interest voterfiles
####----------------------------------------------------------#

# Read the CSV files
vf_wi <- read_csv("state_1pc_samples_aug24/WI_sample.csv") %>%
  filter(sii_deceased == 0)

vf_pa <- read_csv("state_1pc_samples_aug24/PA_sample.csv") %>%
  filter(sii_deceased == 0)

vf_nc <- read_csv("state_1pc_samples_aug24/NC_sample.csv") %>%
  filter(sii_deceased == 0)

vf_nv <- read_csv("state_1pc_samples_aug24/NV_sample.csv") %>%
  filter(sii_deceased == 0)

vf_mi <- read_csv("state_1pc_samples_aug24/MI_sample.csv") %>%
  filter(sii_deceased == 0)

vf_ga <- read_csv("state_1pc_samples_aug24/GA_sample.csv") %>%
  filter(sii_deceased == 0)

vf_az <- read_csv("state_1pc_samples_aug24/AZ_sample.csv") %>%
  filter(sii_deceased == 0)

```

```{r}
####----------------------------------------------------------#
#### Voterfile Data Transformations
####----------------------------------------------------------#

# Define the transformation function 
transform_voter_data <- function(data) {
  data %>%
    # Transform sii_race values
    mutate(sii_race = case_when(
      sii_race == "A" ~ "Asian",
      sii_race == "B" ~ "Black or African American",
      sii_race == "H" ~ "Hispanic or Latino",
      sii_race == "W" ~ "White",
      sii_race == "U" ~ "Unknown",
      sii_race == "O" ~ "Other",
      sii_race == "N" ~ "Native American or Alaska Native",
      TRUE ~ sii_race
    )) %>%
    # Transform sii_age_range from sii_age
    mutate(sii_age_range = case_when(
      sii_age >= 18 & sii_age <= 24 ~ "18-24",
      sii_age >= 25 & sii_age <= 34 ~ "25-34",
      sii_age >= 35 & sii_age <= 44 ~ "35-44",
      sii_age >= 45 & sii_age <= 54 ~ "45-54",
      sii_age >= 55 & sii_age <= 64 ~ "55-64",
      sii_age >= 65 ~ "65+",
      TRUE ~ NA_character_
    )) %>%
    # Transform sii_education_level values
    mutate(sii_education_level = case_when(
      sii_education_level == "A" ~ "Less than High School",
      sii_education_level == "B" ~ "High School Graduate",
      sii_education_level == "C" ~ "Some College",
      sii_education_level == "D" ~ "Bachelor's Degree",
      sii_education_level == "E" ~ "Graduate Degree",
      TRUE ~ "Unknown"
    ))
}

# Apply the transformation function to all state datasets
vf_wi <- transform_voter_data(vf_wi)
vf_pa <- transform_voter_data(vf_pa)
vf_nc <- transform_voter_data(vf_nc)
vf_nv <- transform_voter_data(vf_nv)
vf_mi <- transform_voter_data(vf_mi)
vf_ga <- transform_voter_data(vf_ga)
vf_az <- transform_voter_data(vf_az)

```

```{r}
####----------------------------------------------------------#
#### Grouping voterfile data into one dataset
####----------------------------------------------------------#

# Add state names to each dataset
vf_wi <- vf_wi %>% mutate(state = "WI")
vf_pa <- vf_pa %>% mutate(state = "PA")
vf_nc <- vf_nc %>% mutate(state = "NC")
vf_nv <- vf_nv %>% mutate(state = "NV")
vf_mi <- vf_mi %>% mutate(state = "MI")
vf_ga <- vf_ga %>% mutate(state = "GA")
vf_az <- vf_az %>% mutate(state = "AZ")

# Combine all datasets into one
voter_data <- bind_rows(vf_wi, vf_pa, vf_nc, vf_nv, vf_mi, vf_ga, vf_az)
```


```{r, out.width = "50%"}
####----------------------------------------------------------#
#### Gender, race, and age distributions for each state of interest
####----------------------------------------------------------#

# Gender Distribution
gender_dist <- voter_data %>%
  count(state, sii_gender) %>%
  group_by(state) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()

ggplot(gender_dist, aes(x = state, y = percentage, fill = sii_gender)) +
  geom_bar(stat = "identity") + 
  geom_text(aes(label = paste0(round(percentage, 1), "%")), position = position_stack(vjust = 0.5), size = 3) +
  coord_flip() +
  labs(title = "Gender Distribution by State", x = "", y = "Percentage") +
  scale_fill_manual(
    values = c("F" = "#FF69B4",
               "M" = "#1E90FF",
               "U" = "#A9A9A9",
               "X" = "#800080"),
    labels = c("F" = "Female", "M" = "Male", "U" = "Unknown", "X" = "Other"),
    name = "Gender") +
  barplot_theme +
  theme(axis.title.x = element_blank(),  
        axis.text.x = element_blank())

```
The gender splits of each state are not surprising, with most being around 50/50. While gender alone may not be able to provide significant and high percentage information on who someone is voting for or whether they turn out, what combined with other demographic variables it is possible it may be a statistically significant predictor, as I will explore below. 


```{r, out.width = "50%"}
# Race Distribution, continued from chunk above
race_dist <- voter_data %>%
  count(state, sii_race) %>%
  group_by(state) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()

ggplot(race_dist, aes(x = state, y = percentage, fill = sii_race)) +
  geom_bar(stat = "identity") + 
  geom_text(aes(label = ifelse(percentage >= 3, paste0(round(percentage, 1), "%"), "")), position = position_stack(vjust = 0.5), size = 3) +
  coord_flip() +
  labs(title = "Race Distribution by State", x = "", y = "Percentage") +
  scale_fill_discrete(name = "Race") +
  scale_x_discrete(
    labels = c(
      "Asian" = "Asian",
      "Black or African American" = "Black or\nAfrican American",
      "Hispanic or Latino" = "Hispanic or\nLatino",
      "White" = "White",
      "Unknown" = "Unknown",
      "Other" = "Other",
      "Native American or Alaska Native" = "Native American\nor Alaska Native"
    )
  ) +
  barplot_theme +
  theme(axis.title.x = element_blank(),  
        axis.text.x = element_blank())
```
The distribution of race demographics in the states of interest is more varied than gender. As certain racial demographics may lead to certain political views, which I will attempt to explore later, these different makeups may lead to differing support for the two candidates in these states. The fact that the voters have different characteristics may make it likely that they may support different candidates. It is important also to note that while many states have a large number of white people on the voterfile, large groups of minorities like the hispanic popular of Arizona or African American population of Georgia are often cited on the news as important voting blocks to watch for. However, it is likely that these groups are not a monolith. 

```{r, out.width = "50%"}
# Age Distribution, continued from chunk above
age_dist <- voter_data %>%
   filter(sii_age_range != "NA") %>%
  count(state, sii_age_range) %>%
  group_by(state) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()

ggplot(age_dist, aes(x = state, y = percentage, fill = sii_age_range)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), position = position_stack(vjust = 0.5), size = 3) +
  coord_flip() +
  labs(title = "Age Range Distribution by State", x = "", y = "Percentage") +
  scale_fill_discrete(name = "Age Groups") +
  barplot_theme +
  theme(axis.title.x = element_blank(),  
        axis.text.x = element_blank())
```
The variation in age may also effect turnout or popular vote outcomes, especially when combined with other demographic variables. Age is consistently found to be a good predictor of turnout in logit regressions of historical data, as in [Matsusaka and Palida (1997)](https://www.jstor.org/stable/30024496). They also find education to be a good predictor. Looking later at Kim and Zelinsky (2023), I will explore how much of past turnout and popular vote outcomes these and other demographic variables can really explain. 

While looking at demographics alone can tell me about the makeup of each state, it is also important to understand how each group acts. Below, I plot the percent of people in each age x race category that voted in the 2020 general election. For many groups, it surprisingly low, while for others there is incredibly high turnout (though these groups are consistently very small). The height of each bar represents the percentage of people in that age and race category who voted in the 2020 general election.

```{r, out.width = "40%"}
####----------------------------------------------------------#
#### Percentage of people in each age x race group that voted in 2020 general, bar chart by state
####----------------------------------------------------------#

# Function to summarize voting data with percentage
summarize_voting_percentage <- function(df) {
  df %>%
    filter(!is.na(sii_age_range)) %>% 
    mutate(voted_2020g = ifelse(is.na(svi_vh_2020g), 0, 1)) %>%
    group_by(sii_age_range, sii_race) %>%
    summarise(
      total_voters = n(),
      voted_count = sum(voted_2020g, na.rm = TRUE),
      voted_percentage = (voted_count / total_voters) * 100,
      .groups = "drop"
    )
}

# Summarize voting data for each state
summary_wi <- summarize_voting_percentage(vf_wi)
summary_pa <- summarize_voting_percentage(vf_pa)
summary_nc <- summarize_voting_percentage(vf_nc)
summary_nv <- summarize_voting_percentage(vf_nv)
summary_mi <- summarize_voting_percentage(vf_mi)
summary_ga <- summarize_voting_percentage(vf_ga)
summary_az <- summarize_voting_percentage(vf_az)

# what percent of each race x age group voted
# Wisconsin
ggplot(summary_wi, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Wisconsin), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +  # Legend title for race
  theme_minimal()

# Pennsylvania
ggplot(summary_pa, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Pennsylvania), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

# North Carolina
ggplot(summary_nc, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (North Carolina), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

# Nevada
ggplot(summary_nv, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Nevada), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

# Michigan
ggplot(summary_mi, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Michigan), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

# Georgia
ggplot(summary_ga, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Georgia), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

# Arizona
ggplot(summary_az, aes(x = sii_age_range, y = voted_percentage, fill = sii_race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Voters by Age Range and Race (Arizona), 2020 General", 
       x = "Age Range", 
       y = "Percentage of Voters (%)") +
  scale_fill_discrete(name = "Race") +
  theme_minimal()

```
As is often observed in the literature, there is low turnout in 2020 among young people, but it is worth noting that 18 is the first year they can vote, and the ages in this data are up to date with 2024, making that group significantly smaller in the first place. To understand whether young people actually vote less, it would be best to dive into those currently aged 22-28 to see if and how they voted in 2020. 

Below I also include these graphs as heat maps for ease of reading, but feel free to use whichever works best for your understanding. 

```{r, out.width="30%"}
####----------------------------------------------------------#
#### Percentage of people in each age x race group that voted in 2020 general, heat map by state
####----------------------------------------------------------#

# Wisconsin heatmap
ggplot(summary_wi, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Wisconsin, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# Pennsylvania heatmap
ggplot(summary_pa, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Pennsylvania, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# North Carolina heatmap
ggplot(summary_nc, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in North Carolina, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# Nevada heatmap
ggplot(summary_nv, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Nevada, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# Michigan heatmap
ggplot(summary_mi, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Michigan, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# Georgia heatmap
ggplot(summary_ga, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Georgia, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")

# Arizona heatmap
ggplot(summary_az, aes(x = sii_age_range, y = sii_race, fill = voted_percentage)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "red", high = "forestgreen") +
  geom_text(aes(label = round(voted_percentage, 1)), color = "white") +
  labs(title = "Voting Percentage by Age and Race in Arizona, 2020 General", 
       x = "Age Range", 
       y = "Race") +
  theme_minimal() +
  theme(panel.grid = element_blank(), legend.position = "none")


```


```{r, include = FALSE}
####----------------------------------------------------------#
#### Extra Chunk: Looking at Number of people at each education level counts
####----------------------------------------------------------#

# Function to summarize voting data without modifying original variables
summarize_voting_data_by_education <- function(df) {
  df %>%
    mutate(voted_2020g = ifelse(is.na(svi_vh_2020g), 0, 1)) %>%
    group_by(sii_education_level) %>%
    summarise(voted_count = sum(voted_2020g, na.rm = TRUE), .groups = "drop")
}

# Summarize voting data for each state
summary_wi_education <- summarize_voting_data_by_education(vf_wi)
summary_pa_education <- summarize_voting_data_by_education(vf_pa)
summary_nc_education <- summarize_voting_data_by_education(vf_nc)
summary_nv_education <- summarize_voting_data_by_education(vf_nv)
summary_mi_education <- summarize_voting_data_by_education(vf_mi)
summary_ga_education <- summarize_voting_data_by_education(vf_ga)
summary_az_education <- summarize_voting_data_by_education(vf_az)

# Plotting for how many people of each education level voted in Wisconsin
ggplot(summary_wi_education, aes(x = sii_education_level, y = voted_count)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "2020 General Election Voting by Education Level (Wisconsin)", 
       x = "Education Level", 
       y = "Votes Cast") +
  theme_minimal()
```

```{r, include = FALSE}
####----------------------------------------------------------#
#### Extra Chunk: Looking at Number of people at each education level percents
####----------------------------------------------------------#

# Function to summarize voting data by education level
summarize_voting_data_by_education <- function(df) {
  df %>%
    mutate(voted_2020g = ifelse(is.na(svi_vh_2020g), 0, 1)) %>%
    group_by(sii_education_level) %>%
    summarise(
      voted_count = sum(voted_2020g, na.rm = TRUE),
      total_count = n(),  # Total individuals in each education level
      .groups = "drop"
    ) %>%
    mutate(vote_percentage = (voted_count / total_count) * 100)  # Calculate voting percentage
}

# Summarize voting data for each state
summary_wi_education <- summarize_voting_data_by_education(vf_wi)
summary_pa_education <- summarize_voting_data_by_education(vf_pa)
summary_nc_education <- summarize_voting_data_by_education(vf_nc)
summary_nv_education <- summarize_voting_data_by_education(vf_nv)
summary_mi_education <- summarize_voting_data_by_education(vf_mi)
summary_ga_education <- summarize_voting_data_by_education(vf_ga)
summary_az_education <- summarize_voting_data_by_education(vf_az)

# Plotting for percentage of people of each education level who voted in Wisconsin
ggplot(summary_wi_education, aes(x = sii_education_level, y = vote_percentage)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "2020 General Election Voting by Education Level (Wisconsin)", 
       x = "Education Level", 
       y = "Percentage of Votes Cast") +
  theme_minimal()
```

```{r, include = FALSE}
####----------------------------------------------------------#
#### Extra Chunk: Looking at Number of people at each education level
####----------------------------------------------------------#

# Function to summarize education data
summarize_education_data <- function(df) {
  df %>%
    group_by(sii_education_level) %>%
    summarise(
      total_count = n(),
      voted_count = sum(ifelse(svi_vh_2020g %in% c("NA"), 0, 1), na.rm = TRUE),
      .groups = "drop"
    )
}

# Summarize education data for each state
summary_wi_education <- summarize_education_data(vf_wi)
summary_pa_education <- summarize_education_data(vf_pa)
summary_nc_education <- summarize_education_data(vf_nc)
summary_nv_education <- summarize_education_data(vf_nv)
summary_mi_education <- summarize_education_data(vf_mi)
summary_ga_education <- summarize_education_data(vf_ga)
summary_az_education <- summarize_education_data(vf_az)

# Wisconsin summary
print(summary_wi_education)
```

```{r, include = FALSE}
####----------------------------------------------------------#
#### Extra Chunk: 
####----------------------------------------------------------#

# Add state names to each dataset
vf_wi <- vf_wi %>% mutate(state = "WI")
vf_pa <- vf_pa %>% mutate(state = "PA")
vf_nc <- vf_nc %>% mutate(state = "NC")
vf_nv <- vf_nv %>% mutate(state = "NV")
vf_mi <- vf_mi %>% mutate(state = "MI")
vf_ga <- vf_ga %>% mutate(state = "GA")
vf_az <- vf_az %>% mutate(state = "AZ")

# Combine all datasets into one
voter_data <- bind_rows(vf_wi, vf_pa, vf_nc, vf_nv, vf_mi, vf_ga, vf_az)

# age across states
ggplot(voter_data, aes(x = sii_age_range, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Age Range Distribution by State", x = "Age Range", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# gender across states
ggplot(voter_data, aes(x = sii_gender, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Gender Distribution by State", x = "Gender", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# race across states
ggplot(voter_data, aes(x = sii_race, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Race Distribution by State", x = "Race", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# party registration across states
ggplot(voter_data, aes(x = svi_party_registration, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Party Registration by State", x = "Party Registration", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# education across states
ggplot(voter_data, aes(x = sii_education_level, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Education Level by State", x = "Education Level", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# homeownership across states
ggplot(voter_data, aes(x = sii_homeowner, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Homeownership by State", x = "Homeowner", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()

# urbanicity across states
ggplot(voter_data, aes(x = sii_urbanicity, fill = state)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Urbanicity by State", x = "Population Density", y = "Count") +
  facet_wrap(~state) +
  theme_minimal()
```

Overall, these demographic explorations provide the context necessary as I move into exploring whether they are good to include in my predictive model.


### Demographics and Prediction
- kim and zelinsky replication, plots
- lit review
- will I use them 

### Understanding Turnout
- turnout overtime, plots
- how to get 2024 turnout 

### Simulating the Outcome
- how the method works
- what I have included in my model
- do the simulations, give histogram for seven states 