---
title: 'Week 1: Introduction and Past National Election Data'
author: Jacqui Schlesinger
date: '2024-09-05'
slug: week-1-introductory-post
categories: []
tags: []
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r, results = 'hide'}
# Load libraries
library(ggplot2)
library(maps)
library(tidyverse)
library(plotly)
library(ggrepel)

```

```{r}
####----------------------------------------------------------#
#### Data read in and cleaning
####----------------------------------------------------------#

### Popular vote data
# Read presidential popular vote
d_popvote <- read_csv("C:/Users/Jacqui Schlesinger/Documents/election-blog1/popvote_1948-2020.csv") # if you run this code please change to location of data

# Pivot data to wide format with party names as columns and two-party vote share as values.
d_popvote_wide <- d_popvote |>
    select(year, party, pv2p) |>
    pivot_wider(names_from = party, values_from = pv2p)

# Modify winner column to show "D" if Democrats win and "R" if Republicans win
d_popvote_wide <- d_popvote_wide |> 
    mutate(winner = case_when(democrat > republican ~ "D",
                              TRUE ~ "R"))

### Shape file data
# Sequester shapefile of states from `maps` library
states_map <- map_data("state")

### Candidate votes wide data
# Read wide version of dataset that can be used to compare candidate votes with one another
d_pvstate_wide <- read_csv("C:/Users/Jacqui Schlesinger/Documents/election-blog1/clean_wide_state_2pv_1948_2020.csv") # if you run this code please change to location of data to fit your set up

# Merge d_pvstate_wide with state_map
d_pvstate_wide$region <- tolower(d_pvstate_wide$state)

pv_map <- d_pvstate_wide |>
  left_join(states_map, by = "region")

### Electoral votes data by state and year
ec <- read_csv("C:/Users/Jacqui Schlesinger/Documents/election-blog1/ec_full.csv") # if you run this code please change to location of data to fit your set up

# Update to handle three years where DC electors is NA (2012, 2016, 2020)
ec <- ec %>%
  mutate(electors = ifelse(state == "District Of Columbia" & is.na(electors), 3, electors))

# note: ec dataset is missing 1960 during which the electoral votes were different than in 1956 or 1964 by state, so I have not manually entered them

### Electoral votes by year and party
# because our data does not include info about third parties, I created this csv so that a line plot of electoral college votes will be appropriate for graphing
ec_yearly <- read_csv("C:/Users/Jacqui Schlesinger/Documents/election-blog1/electoral_by_year.csv") # if you run this code please change to location of data to fit your set up

```

```{r}
####----------------------------------------------------------#
#### Extension 1 Partial: Create a Custom Theme
####----------------------------------------------------------#

# Create custom theme for maps 
maps_theme <- theme_bw() + 
    theme(panel.border = element_blank(),     
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          axis.title = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank(),
          plot.title = element_text(size = 12),
          strip.text = element_text(size = 9),
          legend.position = "right",
          legend.text = element_text(size = 8),
          legend.title = element_text(size = 9))

# Create custom theme for line plots
line_plot_theme <- theme_bw() + 
    theme(panel.border = element_blank(),
          plot.title = element_text(size = 15, hjust = 0.5), 
          axis.text.x = element_text(angle = 45, hjust = 1),
          axis.text = element_text(size = 12),
          strip.text = element_text(size = 18),
          axis.line = element_line(colour = "black"),
          legend.position = "bottom",
          legend.text = element_text(size = 12))
```

_Throughout the course of this blog, I will attempt to predict the outcome of the 2024 US presidential election. As a part of Gov 1347: Election Analytics with Professor Enos, I will use data from a variety of sources to develop a compelling model._

This week's explorations focus on data from national presidential election results, 1948-2020. Before diving into a full analysis of the factors leading to a candidate's victory in a presidential election, it is important to understand the trend of past elections. The objective of this post is to answer two questions in furtherance of this goal: **(a) how competitive are presidential elections in the United States**, and **(b) which states vote blue/red and how consistently**. 

To do this, I examine both electoral college results and two-way popular vote results, margins, and year to year swings. I also implement the Helmut Norpoth electoral cycle model to provide a baseline prediction based solely on prior election results, and examine the efficacy of this approach.

#### Popular Vote Over Time
The national popular vote provides information on the percentage of all votes cast nationally that went to a specific candidate. Because of the presence of national and state-by-state third party candidates, it can be helpful to look at a two-way popular vote percentage that a candidate received. This value is calculated similar to the national popular vote percentage, but instead uses only the total votes cast for the two main parties as the total votes, such that the percent of votes for the Democratic and Republican candidates sum to 100%. 

Looking at the two-way popular vote percentage results for Democrats and Republicans in elections 1948 to 2020, we can evaluate how the distribution of the popular vote has changed between the two parties over time.

```{r}
####----------------------------------------------------------#
#### Past Two Way Popular Vote Results
####----------------------------------------------------------#

# Create line plot of R and D two party national popular vote by year
popvote_line <- d_popvote %>%
  ggplot(aes(x = year, y = pv2p, color = party, group=1, text = paste("Year:", year, "<br>2-Way Popular Vote:", round(pv2p, 1), "%"))) + 
  geom_line(stat = "identity") +
  geom_point() +
  scale_color_manual(values = c("dodgerblue4","firebrick1")) +
  xlab("") +
  ylab("Two-Party National Popular Vote (%)") +
  ggtitle("Presidential Vote Share (1948-2020)") + 
  scale_x_continuous(breaks = seq(1948, 2020, 4)) +
  line_plot_theme

ggplotly(popvote_line, tooltip = "text")
```

```{r, results = 'hide'}
####----------------------------------------------------------#
#### Calcs for Paragraph
####----------------------------------------------------------#
diff_calcs <- d_popvote %>%
  group_by(year) %>%
  summarize(
    R_pv2p = pv2p[party == 'republican'],
    D_pv2p = pv2p[party == 'democrat'],
    diff = abs(R_pv2p - D_pv2p)
  ) %>%
  ungroup() %>%
  arrange(desc(diff))

diff_calcs
```

The plot reveals that neither of the two parties has consistently held power over the last 70 years in terms of two-way popular vote, with fluctuations between the two occurring every few election cycles. The differences between the two way popular vote have been both extremely large, like in the case of 1972 when there were 23.6 percentage points between the winner and loser, and extremely small, like in the case of 1960 when there were 0.17 percentage points between Richard Nixon (R) and John F. Kennedy (D). These two-way popular vote margins have fluctuated over the years, but the landslide victories have become less common today, with margins fluctuating still but with consistently tighter races. 

#### Electoral College Results Over Time
The increased tightness of presidential races over time appears to also be present in the results of Electoral College. As the true determinant of presidential election results, the Electoral College provides insight into how close the elections we observed above truly were.   

```{r}
####----------------------------------------------------------#
#### Past Electoral College Results
####----------------------------------------------------------#

# Create line plot of R and D electoral votes by year, removing other candidates
ecvote_line <- ec_yearly %>%
  filter(party != "Other") %>%
  ggplot(aes(x = year, y = electoral_votes, color = party, group=1, text = paste("Year:", year, "<br>Electors:", electoral_votes))) + 
  geom_line(stat = "identity") +
  geom_point() +
  geom_hline(yintercept = 270, linetype = "dotted", color = "yellow") +
  scale_color_manual(values = c("dodgerblue4","firebrick1")) +
  xlab("") +
  ylab("Electoral College Votes (Number of Electors)") +
  ggtitle("Presidential Electoral College Share (1948-2020)") + 
  scale_x_continuous(breaks = seq(1948, 2020, 4)) +
  line_plot_theme

ggplotly(ecvote_line, tooltip = "text")

```

```{r, results = 'hide'}
####----------------------------------------------------------#
#### Calculate background statistics
####----------------------------------------------------------#

# Summarize data with respect to winners
d_popvote_wide |> 
  group_by(winner) |>
  summarise(races = n())

```

With 270 electoral votes needed to win the presidency, the above results in 11 Democrat victories and 8 Republican victories since 1948. Similar to popular vote trends, recent elections appear to have fewer landslide victories for one party or the other. This points to an increased competitiveness in presidential elections.

#### Electoral College Versus Two-Way Popular Vote Share
In close elections, Electoral College victories can often come down to just a few states, even just one **(link)**. Later, I will investigate the electoral and popular vote trends in swing states, responsible for determining the outcome of elections due to their propensity to flip between voting for Republicans or Democrats in state wide popular vote year over year. For now, I will examine  the national electoral votes and two way popular votes since 1948, comparing the two margins of victory over the elections with the largest and smallest margins. 

_1972 (Nixon R vs McGovern D)_: Nixon (R) wins by margin of 23.6 percentage points and 503 electoral votes

_1964 (Goldwater R vs Johnson D)_: Johnson (D) wins by margin of 22.7 percentage points and 434 electoral votes

_1960 (Nixon R vs Kennedy D)_: Kennedy (D) wins by margin of 0.17 percentage points and 84 electoral votes

_2000 (Bush R vs Gore D)_: Bush (R) loses two-way popular vote by margin of 0.5 percentage points but wins electoral college by 5 electoral votes

As seen in 2000 (and 2016, the fifth smallest popular vote margin of 2.32 percentage points more for Clinton (D), who lost), observed fluctuations in both electoral vote and popular vote plots are similar in magnitude, but do not always lead to the same election outcome. Because Electoral College votes are determined by the popular vote within each individual state, to further understand how the popular vote can help predict the winner of the election we will have to explore on a state by state level. 

#### Swing State and Margins Analysis, 1948-2020
Instead of looking solely at win margins for the electoral college and popular vote, as we did above, in order to better understand how to use the data we have to predict the 2024 election result it is important to look at changes year over year on the state level. The swing map below plots the change in the popular vote margin in each election year relative to the results in that state from the last election.

```{r}
####----------------------------------------------------------#
#### Extension 3: Swing State Map Extension
####----------------------------------------------------------#

# Calculate swing map margins for each state and year (D sub y minus D sub y-4) 
pv2p_2024_states <- d_pvstate_wide %>%
  group_by(state) %>%
  mutate(pv2p_margin = D_pv2p - D_pv2p_lag1, region = tolower(state))

d_pvstate_wide %>%
  filter(state == "Utah", year == 2016)

# Join data with states shape file and graph swing for years 1980-2020 using facets
pv2p_2024_states %>% 
  filter(year >= 1980) %>%
  left_join(states_map, by = "region") %>%
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = pv2p_margin), color = "black") +
  facet_wrap(facets = year ~.) + # 
  ggtitle("Change in Vote Margin From Past Election, 1980-2020") + 
  scale_fill_gradient2(
    high = "dodgerblue4",
    mid = "white",
    low = "firebrick1",
    limits = c(-15, 15),
    name = "Percentage Point Swing (pp)"
  ) +
  maps_theme

```

States with darker shading swung more year over year in the direction of their color, red for Republicans and blue for Democrats, relative to its position the past year. This does not mean that states with dark colors are swing states-- in fact, it is the opposite. 

For example, I can dive deeper into results in Utah. In 2008, Republicans won the state with 62.6% of the two-way popular vote. In 2012, Republican Mitt Romney won Utah with 74.6% of the two-way popular vote. The state therefore swung much more red than before, but the outcome of the electoral votes did not change. But in 2016, while Republican Donald Trump still significantly won the state with 62.4% of the two-way popular vote, the margins were not as large as they were with Romney, leading to a blue Utah swing in 2016. This does not mean Utah is a swing state, as it still has not voted for a Democrat since President Johnson in 1964, a year with the second largest landslide victory covered above.

States with consistently much smaller swing are actually more likely to be swing states as this small swing could be around a 50-50 vote. For example, states like Pennsylvania and Arizona have had small swing in the last few elections. It is important to both look at the swing and the actual popular vote result to see which states like these are actually swing states, so a swing map itself helps visualize only how much or little states are moving relatively. For example, in 2008, many states swung more democratic than they had in the past for Obama, leading to a lot of blue, but in 2012 Obama still won despite the large amount of red swing in the states due to a smaller surge on President Obama's part for his re-elect.

#### The Helmut Norpoth Model
As I have shown above, looking at swing and margins alone are not enough to determine whether a candidate will win an election. The same goes for the popular vote outcome nationally, which does not always determine the electoral votes. But looking at state-level popular vote can provide a method for an early and simplified prediction of the 2024 election result based on past results using a simplified version of the [Helmut Northpoth electoral cycle model](http://primarymodel.com/). This simplified model is defined by 

$$ vote_{2024} = 0.75vote_{2020} + 0.25vote_{2016}$$
Using this model in each state with the previous election results we have been analyzing, we can calculate the two-way popular vote, margins, swings, and electoral outcomes by state for the 2024 election. This is a predictive model of the election-- see below for evaluating its effectiveness-- using inputs of past election results to predict a future outcome.

The below map shows the predicted margins of victory in each state using this model, as well as projected winner and total electoral votes available in the state. 

```{r}
####----------------------------------------------------------#
#### 2024 Margins Forecast
####----------------------------------------------------------#

# Create prediction (pv2p and margin) based on Helmut Norpoth electoral cycle model
# vote_2024 = 3/4*vote_2020 + 1/4*vote_2016 (lag1, lag2, respectively)

# Calculate 2024 pv2p and margin
pv2p_2024_states_margins <- d_pvstate_wide %>%
  filter(year == 2020) %>%
  group_by(state) %>%
  summarize(D_pv2p_2024 = 3/4 * D_pv2p + 1/4 * D_pv2p_lag1,
            R_pv2p_2024 = 3/4 * R_pv2p + 1/4 * R_pv2p_lag1) %>%
  mutate(pv2p_2024_margin = R_pv2p_2024 - D_pv2p_2024,
         region = tolower(state))

# Add electoral college votes for map labeling
pv2p_2024_states_margins <- pv2p_2024_states_margins %>%
  mutate(year = 2024,
         winner = ifelse(pv2p_2024_margin > 0, "R", "D")) %>%
  left_join(ec, by = c("state", "year"))

# Plot the projected margin of victory in 2024
base_map <- pv2p_2024_states_margins %>%
  left_join(states_map, by = "region") %>%
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = pv2p_2024_margin,
                   text = paste("State:", state,
                                "<br>Margin:", round(abs(pv2p_2024_margin), 2),
                                "<br>Projected Winner:", winner,
                                "<br>Electoral Votes:", electors)),
               color = "black") +
  ggtitle("2024 Presidential Margins Forecast (Helmut Norpoth Electoral Cycle Model)") + 
  scale_fill_gradient2(high = "firebrick1", 
                       mid = "white", 
                       low = "dodgerblue4", 
                       breaks = c(-50, -25, 0, 25, 50),
                       limits = c(-50, 50),
                       name = "Percentage Point Margin (pp)") +
  maps_theme

# Apply plotly to get hover labels
plotly_map <- ggplotly(base_map, tooltip = "text")
plotly_map

```

States with a small projected margin of victory are consistent with the swing states/ battleground states in this election: Arizona, Georgia, North Carolina, Pennsylvania, Wisconsin, Michigan, and Nevada. We can also look at the projected swing of these states compared to the 2020 election to understand which direction these states are moving in. 

```{r}
####----------------------------------------------------------#
#### Extension 3 Continued x Forecast 2024
####----------------------------------------------------------#

# Calculate 2024 pv2p, margin, swing
pv2p_2024_states_swing <- d_pvstate_wide %>%
  filter(year == 2020) %>%
  group_by(state) %>%
  mutate(D_pv2p_2024 = 3/4 * D_pv2p + 1/4 * D_pv2p_lag1,
            R_pv2p_2024 = 3/4 * R_pv2p + 1/4 * R_pv2p_lag1) %>%
  mutate(pv2p_2024_margin = R_pv2p_2024 - D_pv2p_2024,
         pv2p_2024_swing =  D_pv2p_2024 - D_pv2p,
         region = tolower(state))

# Add electoral college votes for map labeling
pv2p_2024_states_swing <- pv2p_2024_states_swing %>%
  mutate(year = 2024,
         winner = ifelse(pv2p_2024_margin > 0, "R", "D")) %>%
  left_join(ec, by = c("state", "year"))

# Plot the swing from 2020
base_map <- pv2p_2024_states_swing %>%
  left_join(states_map, by = "region") %>%
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = pv2p_2024_swing,
                   text = paste("State:", state,
                                "<br>Swing:", round(pv2p_2024_swing, 2),
                                "<br>Margin:", round(abs(pv2p_2024_margin), 2),
                                "<br>Projected Winner:", winner,
                                "<br>Electoral Votes:", electors)),
               color = "black") +
  ggtitle("2024 Presidential Swing Forecast (Simplified Electoral Cycle Model)") + 
  scale_fill_gradient2(high = "dodgerblue4", 
                       mid = "white", 
                       low = "firebrick1", 
                       breaks = c(-2, -1, 0, 1, 2),
                       limits = c(-2, 2),
                       name = "Percentage Point Swing (pp)") +
  maps_theme

# Apply plotly to get hover labels
plotly_map <- ggplotly(base_map, tooltip = "text")
plotly_map

```

The swing map above projects that most states will swing slightly more Republican than they did in the 2020 election. However, this should not be cause to declare the Republicans victors of the 2024 elections. In fact, this Republican swing makes sense in the context of the simplified model, which relies on 75% of the 2020 results and 25% of the 2016 results in each state. In 2016, many states voted more red than they did in 2020, so just using these two to make a prediction about the election will automatically pull the 2024 forecast to be more Republican than the 2020 results. 

```{r}
####----------------------------------------------------------#
#### Electoral college 2024 predication
####----------------------------------------------------------#

# calculate 2024 pv2p
pv2p_2024_states_elec <- d_pvstate_wide %>%
  filter(year == 2020) %>%
  group_by(state) %>%
  summarize(D_pv2p_2024 = 3/4 * D_pv2p + 1/4 * D_pv2p_lag1,
            R_pv2p_2024 = 3/4 * R_pv2p + 1/4 * R_pv2p_lag1) %>%
  mutate(region = tolower(state))

# figure out who wins each year, join in state electoral counts
pv2p_2024_states_elec <- pv2p_2024_states_elec %>%
  mutate(year = 2024,
         winner = ifelse(R_pv2p_2024 > D_pv2p_2024, "R", "D")) %>%
  left_join(ec, by = c("state", "year"))

# coutn electors for each party
pv2p_2024_states_elec %>%
  group_by(winner) %>%
  summarize(electoral_votes = sum(electors))

## Harris: 276
## Trump: 262
```

In fact, the model forecasts that Vice President Kamala Harris will win 276 electoral to former president Donald Trump's 262, a democratic victory. 

#### Simplified Norporth Model Pitfalls and Future Forecast Additions
The simplified version of Helmut Norpoth's model, which has been in its un-simplified form greater than 50% effective in its predictions, still misses many of the known drivers of voter behavior. For example, a comparison to [Fair's Electoral Models](https://drive.google.com/drive/u/0/folders/1Sim1ht01NGVFkiCzcx7cOVZo97H02xKj) shows the absence of important economic fundamentals that drive voter behavior, as well as factors including incumbency and party in charge. The variables in Fair's model are all economy based, with the intercept taking into account non economic values like past voting. Additionally, the [impact of published forecasts](https://www-journals-uchicago-edu.ezp-prod1.hul.harvard.edu/doi/pdfplus/10.1086%2F708682) on voters and the [potential ineffectiveness of campaign on-the-ground strategy](https://www-cambridge-org.ezp-prod1.hul.harvard.edu/core/journals/american-political-science-review/article/party-activists-as-campaign-advertisers-the-ground-campaign-as-a-principalagent-problem/6117E8EF4C72A046ABFE6A8FDEDEA95E) are not taken into account here. In future models, these and other factors will be explored descriptively and potentially added to the forecast.   

**Current Forecast: Harris 276 - Trump 262**

##### Data Sources
- Popular vote and two-way vote by candidate for Democrat and Republican candidates since 1948
- Popular vote and two-way vote by state for Democrats and Republicans since 1948
- Electoral College electors by state and year
- United States map shapefile

_Note for Gov 1347: This post completes extension 3, as well as parts of extension 1 and 2_